<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<title>Harbor 部署</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge .cm {
  color: #999988;
  font-style: italic;
}
pre.rouge .cp {
  color: #999999;
  font-weight: bold;
}
pre.rouge .c1 {
  color: #999988;
  font-style: italic;
}
pre.rouge .cs {
  color: #999999;
  font-weight: bold;
  font-style: italic;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cpf {
  color: #999988;
  font-style: italic;
}
pre.rouge .err {
  color: #a61717;
  background-color: #e3d2d2;
}
pre.rouge .gd {
  color: #000000;
  background-color: #ffdddd;
}
pre.rouge .ge {
  color: #000000;
  font-style: italic;
}
pre.rouge .gr {
  color: #aa0000;
}
pre.rouge .gh {
  color: #999999;
}
pre.rouge .gi {
  color: #000000;
  background-color: #ddffdd;
}
pre.rouge .go {
  color: #888888;
}
pre.rouge .gp {
  color: #555555;
}
pre.rouge .gs {
  font-weight: bold;
}
pre.rouge .gu {
  color: #aaaaaa;
}
pre.rouge .gt {
  color: #aa0000;
}
pre.rouge .kc {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kd {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kn {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kp {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kr {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kt {
  color: #445588;
  font-weight: bold;
}
pre.rouge .k, pre.rouge .kv {
  color: #000000;
  font-weight: bold;
}
pre.rouge .mf {
  color: #009999;
}
pre.rouge .mh {
  color: #009999;
}
pre.rouge .il {
  color: #009999;
}
pre.rouge .mi {
  color: #009999;
}
pre.rouge .mo {
  color: #009999;
}
pre.rouge .m, pre.rouge .mb, pre.rouge .mx {
  color: #009999;
}
pre.rouge .sa {
  color: #000000;
  font-weight: bold;
}
pre.rouge .sb {
  color: #d14;
}
pre.rouge .sc {
  color: #d14;
}
pre.rouge .sd {
  color: #d14;
}
pre.rouge .s2 {
  color: #d14;
}
pre.rouge .se {
  color: #d14;
}
pre.rouge .sh {
  color: #d14;
}
pre.rouge .si {
  color: #d14;
}
pre.rouge .sx {
  color: #d14;
}
pre.rouge .sr {
  color: #009926;
}
pre.rouge .s1 {
  color: #d14;
}
pre.rouge .ss {
  color: #990073;
}
pre.rouge .s, pre.rouge .dl {
  color: #d14;
}
pre.rouge .na {
  color: #008080;
}
pre.rouge .bp {
  color: #999999;
}
pre.rouge .nb {
  color: #0086B3;
}
pre.rouge .nc {
  color: #445588;
  font-weight: bold;
}
pre.rouge .no {
  color: #008080;
}
pre.rouge .nd {
  color: #3c5d5d;
  font-weight: bold;
}
pre.rouge .ni {
  color: #800080;
}
pre.rouge .ne {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nf, pre.rouge .fm {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nl {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nn {
  color: #555555;
}
pre.rouge .nt {
  color: #000080;
}
pre.rouge .vc {
  color: #008080;
}
pre.rouge .vg {
  color: #008080;
}
pre.rouge .vi {
  color: #008080;
}
pre.rouge .nv, pre.rouge .vm {
  color: #008080;
}
pre.rouge .ow {
  color: #000000;
  font-weight: bold;
}
pre.rouge .o {
  color: #000000;
  font-weight: bold;
}
pre.rouge .w {
  color: #bbbbbb;
}
pre.rouge {
  background-color: #f8f8f8;
}
</style>
</head>
<body class="article toc2 toc-right">
<div id="header">
<h1>Harbor 部署</h1>
<div id="toc" class="toc2">
<div id="toctitle">目录</div>
<ul class="sectlevel1">
<li><a href="#_说明">说明</a>
<ul class="sectlevel2">
<li><a href="#_前置条件">前置条件</a></li>
<li><a href="#_依赖镜像">依赖镜像</a></li>
</ul>
</li>
<li><a href="#_部署准备">部署准备</a>
<ul class="sectlevel2">
<li><a href="#_创建_ldap_group">创建 LDAP Group</a></li>
<li><a href="#_准备数据库">准备数据库</a></li>
<li><a href="#_创建相关的持久卷">创建相关的持久卷</a></li>
</ul>
</li>
<li><a href="#_部署_harbor_应用">部署 Harbor 应用</a>
<ul class="sectlevel2">
<li><a href="#_导入_harbor_配置">导入 Harbor 配置</a>
<ul class="sectlevel3">
<li><a href="#_导入非敏感配置">导入非敏感配置</a></li>
<li><a href="#_导入敏感配置">导入敏感配置</a></li>
</ul>
</li>
<li><a href="#_创建_service">创建 Service</a></li>
<li><a href="#_创建_pod">创建 Pod</a></li>
<li><a href="#_创建_ingress">创建 Ingress</a></li>
<li><a href="#_获取部署状态">获取部署状态</a></li>
</ul>
</li>
<li><a href="#_配置_harbor">配置 Harbor</a>
<ul class="sectlevel2">
<li><a href="#_配置_ldap_管理器">配置 LDAP 管理器</a></li>
<li><a href="#_测试镜像推送">测试镜像推送</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_说明">说明</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_前置条件">前置条件</h3>
<div class="ulist">
<ul>
<li>
<p><strong>Postgres</strong> : <strong>Harbor</strong> 需要 Postgres 数据库才可正常工作</p>
</li>
<li>
<p><strong>LDAP</strong>：<strong>Harbor</strong> 将使用 <strong>LDAP</strong> 统一管理用户</p>
</li>
<li>
<p><strong>StorageClass</strong>： <strong>Harbor</strong> 需要持久化存储数据</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_依赖镜像">依赖镜像</h3>
<div class="paragraph">
<p><strong>Harbor</strong> 需要以下镜像才可运行，离线环境中请将所有镜像导入至所有工作节点。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="text"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre>goharbor/chartmuseum-photon:v2.5.3
goharbor/harbor-core:v2.5.3
goharbor/harbor-exporter:v2.5.3
goharbor/harbor-jobservice:v2.5.3
goharbor/harbor-portal:v2.5.3
goharbor/registry-photon:v2.5.3
goharbor/harbor-registryctl:v2.5.3
goharbor/redis-photon:v2.5.3
goharbor/trivy-adapter-photon:v2.5.3
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_部署准备">部署准备</h2>
<div class="sectionbody">
<div class="paragraph">
<p>在正式部署前，须对现有环境进行配置以满足最低需求。</p>
</div>
<div class="sect2">
<h3 id="_创建_ldap_group">创建 LDAP Group</h3>
<div class="paragraph">
<p>连接你的 <strong>LDAP</strong> 管理器，为其添加如下角色。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="text"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
</pre></td><td class="code"><pre>cn=docker,ou=groups,dc=cluster,dc=local
cn=deploy,ou=groups,dc=cluster,dc=local
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>其中：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>docker</code> 将具有推送和拉取所有镜像的权限。</p>
</li>
<li>
<p><code>deploy</code> 将具有拉取所有镜像的权限。</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_准备数据库">准备数据库</h3>
<div class="paragraph">
<p>连接你的外部 <strong>Postgres</strong> 数据库，创建如下数据库和用户，并为其创建关联。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>数据库：<code>registry</code></p>
</li>
<li>
<p>数据库用户名：<code>harbor</code></p>
</li>
<li>
<p>数据库密码：<code>harbor_password</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>如果你使用的是集群内数据库部署的话可使用以下命令快速创建。</p>
</div>
<div class="paragraph">
<p>使用如下命令连接 <code>Postgres</code> 控制台。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
</pre></td><td class="code"><pre>kubectl <span class="nb">exec</span> <span class="nt">-it</span> <span class="nt">-n</span> core-middle sts-postgres-0 <span class="nt">--</span> psql <span class="nt">-U</span> postgres
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>连接建立后，执行如下 <strong>SQL</strong> 语句创建账户和数据库，执行完成后，使用 <code>\q</code> 退出。。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
</pre></td><td class="code"><pre><span class="k">CREATE</span> <span class="k">ROLE</span> <span class="n">harbor</span> <span class="k">with</span> <span class="n">LOGIN</span> <span class="k">CREATEDB</span> <span class="n">PASSWORD</span> <span class="s1">'harbor_password'</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">DATABASE</span> <span class="n">registry</span><span class="p">;</span>
<span class="k">GRANT</span> <span class="k">ALL</span> <span class="k">PRIVILEGES</span> <span class="k">ON</span> <span class="k">DATABASE</span> <span class="n">registry</span> <span class="k">to</span> <span class="n">harbor</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>如果要清除旧的数据，可执行以下 <strong>SQL</strong> 语句,然后再重新创建即可。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
</pre></td><td class="code"><pre><span class="k">DROP</span> <span class="k">DATABASE</span> <span class="n">registry</span><span class="p">;</span>
<span class="k">DROP</span> <span class="k">ROLE</span> <span class="n">harbor</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_创建相关的持久卷">创建相关的持久卷</h3>
<div class="paragraph">
<p>在 <strong>Kubernetes</strong> 下导入以下配置，创建对应的持久卷。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
</pre></td><td class="code"><pre><span class="na">kind</span><span class="pi">:</span> <span class="s">PersistentVolumeClaim</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">core-app</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">pvc-harbor-chart-museum</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">harbor</span>
    <span class="na">component</span><span class="pi">:</span> <span class="s">chart-museum</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">accessModes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">ReadWriteOnce</span>
  <span class="na">resources</span><span class="pi">:</span>
    <span class="na">requests</span><span class="pi">:</span>
      <span class="na">storage</span><span class="pi">:</span> <span class="s">5Gi</span>
  <span class="na">storageClassName</span><span class="pi">:</span> <span class="s1">'</span><span class="s">sc-nfs-share'</span>
<span class="nn">---</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">PersistentVolumeClaim</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">core-app</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">pvc-harbor-job-service-scan-data</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">harbor</span>
    <span class="na">component</span><span class="pi">:</span> <span class="s">job-service</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">accessModes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">ReadWriteOnce</span>
  <span class="na">resources</span><span class="pi">:</span>
    <span class="na">requests</span><span class="pi">:</span>
      <span class="na">storage</span><span class="pi">:</span> <span class="s">1Gi</span>
  <span class="na">storageClassName</span><span class="pi">:</span> <span class="s1">'</span><span class="s">sc-nfs-share'</span>
<span class="nn">---</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">PersistentVolumeClaim</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">core-app</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">pvc-harbor-job-service</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">harbor</span>
    <span class="na">component</span><span class="pi">:</span> <span class="s">job-service</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">accessModes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">ReadWriteOnce</span>
  <span class="na">resources</span><span class="pi">:</span>
    <span class="na">requests</span><span class="pi">:</span>
      <span class="na">storage</span><span class="pi">:</span> <span class="s">1Gi</span>
  <span class="na">storageClassName</span><span class="pi">:</span> <span class="s1">'</span><span class="s">sc-nfs-share'</span>
<span class="nn">---</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">PersistentVolumeClaim</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">core-app</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">pvc-harbor-registry</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">harbor</span>
    <span class="na">component</span><span class="pi">:</span> <span class="s">registry</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">accessModes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">ReadWriteOnce</span>
  <span class="na">resources</span><span class="pi">:</span>
    <span class="na">requests</span><span class="pi">:</span>
      <span class="na">storage</span><span class="pi">:</span> <span class="s">50Gi</span>
  <span class="na">storageClassName</span><span class="pi">:</span> <span class="s1">'</span><span class="s">sc-nfs-share'</span>
<span class="nn">---</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">PersistentVolumeClaim</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">core-app</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">pvc-harbor-trivy-data</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">harbor</span>
    <span class="na">component</span><span class="pi">:</span> <span class="s">harbor-trivy</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">accessModes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">ReadWriteOnce</span>
  <span class="na">resources</span><span class="pi">:</span>
    <span class="na">requests</span><span class="pi">:</span>
      <span class="na">storage</span><span class="pi">:</span> <span class="s">5Gi</span>
  <span class="na">storageClassName</span><span class="pi">:</span> <span class="s1">'</span><span class="s">sc-nfs-share'</span>
<span class="nn">---</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">PersistentVolumeClaim</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">core-app</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">pvc-harbor-redis-data</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">harbor</span>
    <span class="na">component</span><span class="pi">:</span> <span class="s">harbor-redis</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">accessModes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">ReadWriteOnce</span>
  <span class="na">resources</span><span class="pi">:</span>
    <span class="na">requests</span><span class="pi">:</span>
      <span class="na">storage</span><span class="pi">:</span> <span class="s">1Gi</span>
  <span class="na">storageClassName</span><span class="pi">:</span> <span class="s1">'</span><span class="s">sc-nfs-share'</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_部署_harbor_应用">部署 Harbor 应用</h2>
<div class="sectionbody">
<div class="paragraph">
<p>资源准备完成后，即可开始部署 <strong>Harbor</strong> 。</p>
</div>
<div class="sect2">
<h3 id="_导入_harbor_配置">导入 Harbor 配置</h3>
<div class="sect3">
<h4 id="_导入非敏感配置">导入非敏感配置</h4>
<div class="paragraph">
<p>在 <strong>Kubernetes</strong> 下导入以下配置，创建 <strong>Harbor</strong> 自定义配置。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
</pre></td><td class="code"><pre><span class="c1"># Source: harbor/templates/chartmuseum/chartmuseum-cm.yaml</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ConfigMap</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">core-app</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">conf-harbor-chart-museum</span>
<span class="na">data</span><span class="pi">:</span>
  <span class="na">PORT</span><span class="pi">:</span> <span class="s2">"</span><span class="s">9999"</span>
  <span class="na">CACHE</span><span class="pi">:</span> <span class="s2">"</span><span class="s">redis"</span>
  <span class="na">CACHE_REDIS_ADDR</span><span class="pi">:</span> <span class="s2">"</span><span class="s">svc-harbor-redis:6379"</span>
  <span class="na">CACHE_REDIS_DB</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3"</span>
  <span class="na">BASIC_AUTH_USER</span><span class="pi">:</span> <span class="s2">"</span><span class="s">chart_controller"</span>
  <span class="na">DEPTH</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1"</span>
  <span class="na">DEBUG</span><span class="pi">:</span> <span class="s2">"</span><span class="s">false"</span>
  <span class="na">LOG_JSON</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
  <span class="na">DISABLE_METRICS</span><span class="pi">:</span> <span class="s2">"</span><span class="s">false"</span>
  <span class="na">DISABLE_API</span><span class="pi">:</span> <span class="s2">"</span><span class="s">false"</span>
  <span class="na">DISABLE_STATEFILES</span><span class="pi">:</span> <span class="s2">"</span><span class="s">false"</span>
  <span class="na">ALLOW_OVERWRITE</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
  <span class="na">AUTH_ANONYMOUS_GET</span><span class="pi">:</span> <span class="s2">"</span><span class="s">false"</span>
  <span class="na">CONTEXT_PATH</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
  <span class="na">INDEX_LIMIT</span><span class="pi">:</span> <span class="s2">"</span><span class="s">0"</span>
  <span class="na">MAX_STORAGE_OBJECTS</span><span class="pi">:</span> <span class="s2">"</span><span class="s">0"</span>
  <span class="na">MAX_UPLOAD_SIZE</span><span class="pi">:</span> <span class="s2">"</span><span class="s">20971520"</span>
  <span class="na">CHART_POST_FORM_FIELD_NAME</span><span class="pi">:</span> <span class="s2">"</span><span class="s">chart"</span>
  <span class="na">PROV_POST_FORM_FIELD_NAME</span><span class="pi">:</span> <span class="s2">"</span><span class="s">prov"</span>
  <span class="na">STORAGE</span><span class="pi">:</span> <span class="s2">"</span><span class="s">local"</span>
  <span class="na">STORAGE_LOCAL_ROOTDIR</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/chart_storage"</span>
  <span class="na">STORAGE_TIMESTAMP_TOLERANCE</span><span class="pi">:</span> <span class="s">1s</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ConfigMap</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">core-app</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">conf-harbor-core</span>
<span class="na">data</span><span class="pi">:</span>
  <span class="na">app.conf</span><span class="pi">:</span> <span class="pi">|+</span>
    <span class="s">appname = Harbor</span>
    <span class="s">runmode = prod</span>
    <span class="s">enablegzip = true</span>

    <span class="s">[prod]</span>
    <span class="s">httpport = 8080</span>
  <span class="na">PORT</span><span class="pi">:</span> <span class="s2">"</span><span class="s">8080"</span>
  <span class="na">DATABASE_TYPE</span><span class="pi">:</span> <span class="s2">"</span><span class="s">postgresql"</span>
  <span class="na">POSTGRESQL_HOST</span><span class="pi">:</span> <span class="s2">"</span><span class="s">svc-postgres.core-middle.svc.cluster.local"</span>
  <span class="na">POSTGRESQL_PORT</span><span class="pi">:</span> <span class="s2">"</span><span class="s">5432"</span>
  <span class="na">POSTGRESQL_USERNAME</span><span class="pi">:</span> <span class="s2">"</span><span class="s">harbor"</span>
  <span class="na">POSTGRESQL_DATABASE</span><span class="pi">:</span> <span class="s2">"</span><span class="s">registry"</span>
  <span class="na">POSTGRESQL_SSLMODE</span><span class="pi">:</span> <span class="s2">"</span><span class="s">disable"</span>
  <span class="na">POSTGRESQL_MAX_IDLE_CONNS</span><span class="pi">:</span> <span class="s2">"</span><span class="s">100"</span>
  <span class="na">POSTGRESQL_MAX_OPEN_CONNS</span><span class="pi">:</span> <span class="s2">"</span><span class="s">900"</span>
  <span class="na">EXT_ENDPOINT</span><span class="pi">:</span> <span class="s2">"</span><span class="s">https://harbor.d7z.net"</span>
  <span class="na">CORE_URL</span><span class="pi">:</span> <span class="s2">"</span><span class="s">http://svc-harbor-core:80"</span>
  <span class="na">JOBSERVICE_URL</span><span class="pi">:</span> <span class="s2">"</span><span class="s">http://svc-harbor-job-service"</span>
  <span class="na">REGISTRY_URL</span><span class="pi">:</span> <span class="s2">"</span><span class="s">http://svc-harbor-registry:5000"</span>
  <span class="na">TOKEN_SERVICE_URL</span><span class="pi">:</span> <span class="s2">"</span><span class="s">http://svc-harbor-core:80/service/token"</span>
  <span class="na">WITH_NOTARY</span><span class="pi">:</span> <span class="s2">"</span><span class="s">false"</span>
  <span class="na">CORE_LOCAL_URL</span><span class="pi">:</span> <span class="s2">"</span><span class="s">http://127.0.0.1:8080"</span>
  <span class="na">WITH_TRIVY</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
  <span class="na">TRIVY_ADAPTER_URL</span><span class="pi">:</span> <span class="s2">"</span><span class="s">http://svc-harbor-trivy:8080"</span>
  <span class="na">REGISTRY_STORAGE_PROVIDER_NAME</span><span class="pi">:</span> <span class="s2">"</span><span class="s">filesystem"</span>
  <span class="na">WITH_CHARTMUSEUM</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
  <span class="na">CHART_REPOSITORY_URL</span><span class="pi">:</span> <span class="s2">"</span><span class="s">http://svc-harbor-chart-museum"</span>
  <span class="na">LOG_LEVEL</span><span class="pi">:</span> <span class="s2">"</span><span class="s">info"</span>
  <span class="na">CONFIG_PATH</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/etc/core/app.conf"</span>
  <span class="na">CHART_CACHE_DRIVER</span><span class="pi">:</span> <span class="s2">"</span><span class="s">redis"</span>
  <span class="na">_REDIS_URL_CORE</span><span class="pi">:</span> <span class="s2">"</span><span class="s">redis://svc-harbor-redis:6379/0?idle_timeout_seconds=30"</span>
  <span class="na">_REDIS_URL_REG</span><span class="pi">:</span> <span class="s2">"</span><span class="s">redis://svc-harbor-redis:6379/2?idle_timeout_seconds=30"</span>
  <span class="na">PORTAL_URL</span><span class="pi">:</span> <span class="s2">"</span><span class="s">http://svc-harbor-portal"</span>
  <span class="na">REGISTRY_CONTROLLER_URL</span><span class="pi">:</span> <span class="s2">"</span><span class="s">http://svc-harbor-registry:8080"</span>
  <span class="na">REGISTRY_CREDENTIAL_USERNAME</span><span class="pi">:</span> <span class="s2">"</span><span class="s">harbor_registry_user"</span>
  <span class="na">HTTP_PROXY</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
  <span class="na">HTTPS_PROXY</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
  <span class="na">NO_PROXY</span><span class="pi">:</span> <span class="s2">"</span><span class="s">svc-harbor-core,svc-harbor-job-service,harbor-database,svc-harbor-chart-museum,svc-harbor-notary-server,svc-harbor-notary-signer,svc-harbor-registry,svc-harbor-portal,svc-harbor-trivy,svc-harbor-exporter,127.0.0.1,localhost,.local,.internal"</span>
  <span class="na">PERMITTED_REGISTRY_TYPES_FOR_PROXY_CACHE</span><span class="pi">:</span> <span class="s2">"</span><span class="s">docker-hub,harbor,azure-acr,aws-ecr,google-gcr,quay,docker-registry"</span>
  <span class="na">METRIC_ENABLE</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
  <span class="na">METRIC_PATH</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/metrics"</span>
  <span class="na">METRIC_PORT</span><span class="pi">:</span> <span class="s2">"</span><span class="s">8001"</span>
  <span class="na">METRIC_NAMESPACE</span><span class="pi">:</span> <span class="s">harbor</span>
  <span class="na">METRIC_SUBSYSTEM</span><span class="pi">:</span> <span class="s">core</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ConfigMap</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">core-app</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">conf-harbor-exporter-env</span>
<span class="na">data</span><span class="pi">:</span>
  <span class="na">HTTP_PROXY</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
  <span class="na">HTTPS_PROXY</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
  <span class="na">NO_PROXY</span><span class="pi">:</span> <span class="s2">"</span><span class="s">svc-harbor-core,svc-harbor-job-service,harbor-database,svc-harbor-chart-museum,svc-harbor-notary-server,svc-harbor-notary-signer,svc-harbor-registry,svc-harbor-portal,svc-harbor-trivy,svc-harbor-exporter,127.0.0.1,localhost,.local,.internal"</span>
  <span class="na">LOG_LEVEL</span><span class="pi">:</span> <span class="s2">"</span><span class="s">info"</span>
  <span class="na">HARBOR_EXPORTER_PORT</span><span class="pi">:</span> <span class="s2">"</span><span class="s">8001"</span>
  <span class="na">HARBOR_EXPORTER_METRICS_PATH</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/metrics"</span>
  <span class="na">HARBOR_EXPORTER_METRICS_ENABLED</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
  <span class="na">HARBOR_EXPORTER_CACHE_TIME</span><span class="pi">:</span> <span class="s2">"</span><span class="s">23"</span>
  <span class="na">HARBOR_EXPORTER_CACHE_CLEAN_INTERVAL</span><span class="pi">:</span> <span class="s2">"</span><span class="s">14400"</span>
  <span class="na">HARBOR_METRIC_NAMESPACE</span><span class="pi">:</span> <span class="s">harbor</span>
  <span class="na">HARBOR_METRIC_SUBSYSTEM</span><span class="pi">:</span> <span class="s">exporter</span>
  <span class="na">HARBOR_REDIS_URL</span><span class="pi">:</span> <span class="s2">"</span><span class="s">redis://svc-harbor-redis:6379/1"</span>
  <span class="na">HARBOR_REDIS_NAMESPACE</span><span class="pi">:</span> <span class="s">harbor_job_service_namespace</span>
  <span class="na">HARBOR_REDIS_TIMEOUT</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3600"</span>
  <span class="na">HARBOR_SERVICE_SCHEME</span><span class="pi">:</span> <span class="s2">"</span><span class="s">http"</span>
  <span class="na">HARBOR_SERVICE_HOST</span><span class="pi">:</span> <span class="s2">"</span><span class="s">svc-harbor-core"</span>
  <span class="na">HARBOR_SERVICE_PORT</span><span class="pi">:</span> <span class="s2">"</span><span class="s">80"</span>
  <span class="na">HARBOR_DATABASE_HOST</span><span class="pi">:</span> <span class="s2">"</span><span class="s">svc-postgres.core-middle.svc.cluster.local"</span>
  <span class="na">HARBOR_DATABASE_PORT</span><span class="pi">:</span> <span class="s2">"</span><span class="s">5432"</span>
  <span class="na">HARBOR_DATABASE_USERNAME</span><span class="pi">:</span> <span class="s2">"</span><span class="s">harbor"</span>
  <span class="na">HARBOR_DATABASE_DBNAME</span><span class="pi">:</span> <span class="s2">"</span><span class="s">registry"</span>
  <span class="na">HARBOR_DATABASE_SSLMODE</span><span class="pi">:</span> <span class="s2">"</span><span class="s">disable"</span>
  <span class="na">HARBOR_DATABASE_MAX_IDLE_CONNS</span><span class="pi">:</span> <span class="s2">"</span><span class="s">100"</span>
  <span class="na">HARBOR_DATABASE_MAX_OPEN_CONNS</span><span class="pi">:</span> <span class="s2">"</span><span class="s">900"</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ConfigMap</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">core-app</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">conf-harbor-job-service-env</span>
<span class="na">data</span><span class="pi">:</span>
  <span class="na">CORE_URL</span><span class="pi">:</span> <span class="s2">"</span><span class="s">http://svc-harbor-core:80"</span>
  <span class="na">TOKEN_SERVICE_URL</span><span class="pi">:</span> <span class="s2">"</span><span class="s">http://svc-harbor-core:80/service/token"</span>
  <span class="na">REGISTRY_URL</span><span class="pi">:</span> <span class="s2">"</span><span class="s">http://svc-harbor-registry:5000"</span>
  <span class="na">REGISTRY_CONTROLLER_URL</span><span class="pi">:</span> <span class="s2">"</span><span class="s">http://svc-harbor-registry:8080"</span>
  <span class="na">REGISTRY_CREDENTIAL_USERNAME</span><span class="pi">:</span> <span class="s2">"</span><span class="s">harbor_registry_user"</span>
  <span class="na">HTTP_PROXY</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
  <span class="na">HTTPS_PROXY</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
  <span class="na">NO_PROXY</span><span class="pi">:</span> <span class="s2">"</span><span class="s">svc-harbor-core,svc-harbor-job-service,harbor-database,svc-harbor-chart-museum,svc-harbor-notary-server,svc-harbor-notary-signer,svc-harbor-registry,svc-harbor-portal,svc-harbor-trivy,svc-harbor-exporter,127.0.0.1,localhost,.local,.internal"</span>
  <span class="na">METRIC_NAMESPACE</span><span class="pi">:</span> <span class="s">harbor</span>
  <span class="na">METRIC_SUBSYSTEM</span><span class="pi">:</span> <span class="s">jobservice</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ConfigMap</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">core-app</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">harbor-job-service</span>
<span class="na">data</span><span class="pi">:</span>
  <span class="na">config.yml</span><span class="pi">:</span> <span class="pi">|+</span>
    <span class="s">#Server listening port</span>
    <span class="s">protocol: "http"</span>
    <span class="s">port: 8080</span>
    <span class="s">worker_pool:</span>
      <span class="s">workers: 10</span>
      <span class="s">backend: "redis"</span>
      <span class="s">redis_pool:</span>
        <span class="s">redis_url: "redis://svc-harbor-redis:6379/1"</span>
        <span class="s">namespace: "harbor_job_service_namespace"</span>
        <span class="s">idle_timeout_second: 3600</span>
    <span class="s">job_loggers:</span>
      <span class="s">- name: "FILE"</span>
        <span class="s">level: INFO</span>
        <span class="s">settings: # Customized settings of logger</span>
          <span class="s">base_dir: "/var/log/jobs"</span>
        <span class="s">sweeper:</span>
          <span class="s">duration: 14 #days</span>
          <span class="s">settings: # Customized settings of sweeper</span>
            <span class="s">work_dir: "/var/log/jobs"</span>
      <span class="s">- name: "STD_OUTPUT"</span>
        <span class="s">level: INFO</span>
    <span class="s">metric:</span>
      <span class="s">enabled: true</span>
      <span class="s">path: /metrics</span>
      <span class="s">port: 8001</span>
    <span class="s">#Loggers for the job service</span>
    <span class="s">loggers:</span>
      <span class="s">- name: "STD_OUTPUT"</span>
        <span class="s">level: INFO</span>
<span class="s">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ConfigMap</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">core-app</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">conf-harbor-portal</span>
<span class="na">data</span><span class="pi">:</span>
  <span class="na">nginx.conf</span><span class="pi">:</span> <span class="pi">|+</span>
    <span class="s">worker_processes auto;</span>
    <span class="s">pid /tmp/nginx.pid;</span>
    <span class="s">events {</span>
        <span class="s">worker_connections  1024;</span>
    <span class="s">}</span>
    <span class="s">http {</span>
        <span class="s">client_body_temp_path /tmp/client_body_temp;</span>
        <span class="s">proxy_temp_path /tmp/proxy_temp;</span>
        <span class="s">fastcgi_temp_path /tmp/fastcgi_temp;</span>
        <span class="s">uwsgi_temp_path /tmp/uwsgi_temp;</span>
        <span class="s">scgi_temp_path /tmp/scgi_temp;</span>
        <span class="s">server {</span>
            <span class="s">listen 8080;</span>
            <span class="s">listen [::]:8080;</span>
            <span class="s">server_name  localhost;</span>
            <span class="s">root   /usr/share/nginx/html;</span>
            <span class="s">index  index.html index.htm;</span>
            <span class="s">include /etc/nginx/mime.types;</span>
            <span class="s">gzip on;</span>
            <span class="s">gzip_min_length 1000;</span>
            <span class="s">gzip_proxied expired no-cache no-store private auth;</span>
            <span class="s">gzip_types text/plain text/css application/json application/javascript application/x-javascript text/xml application/xml application/xml+rss text/javascript;</span>
            <span class="s">location / {</span>
                <span class="s">try_files $uri $uri/ /index.html;</span>
            <span class="s">}</span>
            <span class="s">location = /index.html {</span>
                <span class="s">add_header Cache-Control "no-store, no-cache, must-revalidate";</span>
            <span class="s">}</span>
        <span class="s">}</span>
    <span class="s">}</span>
<span class="s">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ConfigMap</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">core-app</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">conf-harbor-registry</span>
<span class="na">data</span><span class="pi">:</span>
  <span class="na">config.yml</span><span class="pi">:</span> <span class="pi">|+</span>
    <span class="s">version: 0.1</span>
    <span class="s">log:</span>
      <span class="s">level: info</span>
      <span class="s">fields:</span>
        <span class="s">service: registry</span>
    <span class="s">storage:</span>
      <span class="s">filesystem:</span>
        <span class="s">rootdirectory: /storage</span>
      <span class="s">cache:</span>
        <span class="s">layerinfo: redis</span>
      <span class="s">maintenance:</span>
        <span class="s">uploadpurging:</span>
          <span class="s">enabled: true</span>
          <span class="s">age: 168h</span>
          <span class="s">interval: 24h</span>
          <span class="s">dryrun: false</span>
      <span class="s">delete:</span>
        <span class="s">enabled: true</span>
      <span class="s">redirect:</span>
        <span class="s">disable: false</span>
    <span class="s">redis:</span>
      <span class="s">addr: svc-harbor-redis:6379</span>
      <span class="s">db: 2</span>
      <span class="s">readtimeout: 10s</span>
      <span class="s">writetimeout: 10s</span>
      <span class="s">dialtimeout: 10s</span>
      <span class="s">pool:</span>
        <span class="s">maxidle: 100</span>
        <span class="s">maxactive: 500</span>
        <span class="s">idletimeout: 60s</span>
    <span class="s">http:</span>
      <span class="s">addr: :5000</span>
      <span class="s">relativeurls: false</span>
      <span class="s"># set via environment variable</span>
      <span class="s"># secret: placeholder</span>
      <span class="s">debug:</span>
        <span class="s">addr: :8001</span>
        <span class="s">prometheus:</span>
          <span class="s">enabled: true</span>
          <span class="s">path: /metrics</span>
    <span class="s">auth:</span>
      <span class="s">htpasswd:</span>
        <span class="s">realm: harbor-registry-basic-realm</span>
        <span class="s">path: /etc/registry/passwd</span>
    <span class="s">validation:</span>
      <span class="s">disabled: true</span>
    <span class="s">compatibility:</span>
      <span class="s">schema1:</span>
        <span class="s">enabled: true</span>
  <span class="na">ctl-config.yml</span><span class="pi">:</span> <span class="pi">|+</span>
    <span class="s">---</span>
    <span class="s">protocol: "http"</span>
    <span class="s">port: 8080</span>
    <span class="s">log_level: info</span>
    <span class="s">registry_config: "/etc/registry/config.yml"</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_导入敏感配置">导入敏感配置</h4>
<div class="paragraph">
<p>在 <strong>Kubernetes</strong> 下导入以下配置，创建 <strong>Harbor</strong> 账户密码相关配置。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
</pre></td><td class="code"><pre><span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Secret</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">core-app</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">secret-harbor-chart-museum</span>
<span class="na">type</span><span class="pi">:</span> <span class="s">Opaque</span>
<span class="na">stringData</span><span class="pi">:</span>
  <span class="na">CACHE_REDIS_PASSWORD</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Secret</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">core-app</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">secret-harbor-internal-tls</span>
<span class="na">type</span><span class="pi">:</span> <span class="s">Opaque</span>
<span class="na">data</span><span class="pi">:</span>
  <span class="na">tls.crt</span><span class="pi">:</span> <span class="s">LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUUwekNDQXJ1Z0F3SUJBZ0lKQVBZL096TE1lVnEyTUEwR0NTcUdTSWIzRFFFQkN3VUFNQUF3SGhjTk1Ua3cKTkRFNE1ESXlOek0zV2hjTk1qa3dOREUxTURJeU56TTNXakFBTUlJQ0lqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQwpBZzhBTUlJQ0NnS0NBZ0VBM3hsVUpzMmIvYUkyTkxveTRPSVErZG4veU1iL085OWlLRFJ5WktwSDhyU09tUytvCkY5dW5tU0F6TDY1WEEvdjZuWTBPTEkvZEFTRGprcWtCcElkVEd6b2dSNWY4VWlCNm9zdUVZN1Y3MVhaZHpXTHIKUGpuSnE2WkxBYW9LbXdHODBXNStXZDZWOFB5Z094NTJta3IxdzdJV0t6KzFaTEk1aXpicHBvbjdYVkdWUmFBVApSdk5aRGlKNkNlSnBjSjVINzIzbGtmNVJ2SldhdFpMQ1lJWURiUmZUaUtzeVEvU2xSY3Y1QlZmSGcvTEpTSDlRCkxHUmhQTUFSbGRsOXd5WkN3WlpESHhoZUk0YSsyNmFhOE1ZM3U5c3QvbDAvT282VkNUR3BNaUVoaUdGMkxWanAKVVdxLytCUDRTRkV2SmZxL0R1aW5JMTM5Vy81YVpaNy9Id1JQbG1ZVTZwWFRSTHlJZzdqZCsxOWZKd1I3WDM3cQp3MG84dDA2RmhqbXJDemFZQ1Vqb1JlcURtSGFObVpOL2Rkdkc3alpXQnUrak5oMFlhdnN5UXlDSVZtdjZ5cVNjCmpQaUQ5dWl2eHFUd2pKaWRJQlJmdVVyejNhRVJRN2NRZ2YwcWhxakl6Zmx6SGJGS2hJTG9jQldxN3p5Tmw5aHIKdlVHVC9XWmN3MHQvT3RNNzJTUGFwbG1UZ1ZiYlFSeGYyVkh6eXB0R0l2dHlkbFhLOHRoeE9NcFhvNGUrU2w4ZAoxZ2RRY0M0b2lzTjlGMjlvTnM4UDV5RlFQLy94WXV2OEM2MDduQ2oxRHpySWQ1YXZHL05WZktCL2ZiREtFRmdOCjJXaEhJblR6UExFY2pGNGZFcmNVQUV1V1cwYnVYLzZGSENHM2lUdHJxeUQ5MktUVkRmTjFKNTZycmNzQ0F3RUEKQWFOUU1FNHdIUVlEVlIwT0JCWUVGRmhOaFRvNFVBQzJQVXNmOGpZYVdqMTYwdkdFTUI4R0ExVWRJd1FZTUJhQQpGRmhOaFRvNFVBQzJQVXNmOGpZYVdqMTYwdkdFTUF3R0ExVWRFd1FGTUFNQkFmOHdEUVlKS29aSWh2Y05BUUVMCkJRQURnZ0lCQU1Bc0V0VmxFTE13ZHRjaWZIZU9UMGtPbWY1d285SW4vZUZTZ3NjQ3pCTURhUngyQjNxMzZBb1MKSWw3WFdBWnBldmFSN1c3eWVBUkthQXNoQkxoeWdVcUxEMHpXYktsU045SHByZDF3ZHBNMGZmeVBwTjVkeE9ZQQplcjA0eTEyR1JuQ2JNWXFpNGN2enRQNFRpblhxcTJ5SFNZaExiTzlxa0k1Z2JXVnhrUnVJY01Ldml4ZGRsbE5ZClEzb2JKYURESG1vdk0zK2cvRysxWUZndDRxRVMzOFhuSjdCclNzaEhubjVFSVFoMjg2eGZKcml5cksyaEhiTEoKcXowWXVGNkczRFhQZVdHZ1h2ajBIaXBjMGY4VURaa0tray9lR0VJNnZFa3l0eXZvZXBvWkkyWGJBZi9aTXk1bgpLd3VoRW40aGhrRk13V2FTV3AvaDBRZE1DYXhrNEJWU09xbU5WYUxTQjcrRmpzSWo0Q2FzRm90WWl5SjJncFJCCk5mOFFhUzRiejBUbjFlQmJDOGtzaitlM1pXZVgyYjV3Vk1qcWw5alR0MlgxSUNzOEtLZTN2RUJranFUMkFVaTIKNTJUdEt6bTczYVdyei9HUHkvUTJMQ29yM0ZoOUZHVlNCT0JCRFhHeTZNSnBOSEpuWVZIOUVFTkZHT2g4NW9sMQoycEFET0JCNXZBVS9rTEI1TEhQajJrdWUvRk1pSGFObnJTWUlHck1sQlNYMmpqOUVZYTF1dVVIK3BkNE1CajFGCjV1SDhPUmlhUTZodDIrV0hrbHhpYzFSajV5VFlRd1ZsSDcwQ0JPbitxVkVkbzYzeVF3ekFNSktGSXdsR1VRRVgKamlsamdjODZxNGNadFVURnJjd01pZGJrKzhRNitKYkRWZzdIVi8rcG5DK3dudjE5N2t3ZQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==</span>
  <span class="na">tls.key</span><span class="pi">:</span> <span class="s">LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlKS1FJQkFBS0NBZ0VBM3hsVUpzMmIvYUkyTkxveTRPSVErZG4veU1iL085OWlLRFJ5WktwSDhyU09tUytvCkY5dW5tU0F6TDY1WEEvdjZuWTBPTEkvZEFTRGprcWtCcElkVEd6b2dSNWY4VWlCNm9zdUVZN1Y3MVhaZHpXTHIKUGpuSnE2WkxBYW9LbXdHODBXNStXZDZWOFB5Z094NTJta3IxdzdJV0t6KzFaTEk1aXpicHBvbjdYVkdWUmFBVApSdk5aRGlKNkNlSnBjSjVINzIzbGtmNVJ2SldhdFpMQ1lJWURiUmZUaUtzeVEvU2xSY3Y1QlZmSGcvTEpTSDlRCkxHUmhQTUFSbGRsOXd5WkN3WlpESHhoZUk0YSsyNmFhOE1ZM3U5c3QvbDAvT282VkNUR3BNaUVoaUdGMkxWanAKVVdxLytCUDRTRkV2SmZxL0R1aW5JMTM5Vy81YVpaNy9Id1JQbG1ZVTZwWFRSTHlJZzdqZCsxOWZKd1I3WDM3cQp3MG84dDA2RmhqbXJDemFZQ1Vqb1JlcURtSGFObVpOL2Rkdkc3alpXQnUrak5oMFlhdnN5UXlDSVZtdjZ5cVNjCmpQaUQ5dWl2eHFUd2pKaWRJQlJmdVVyejNhRVJRN2NRZ2YwcWhxakl6Zmx6SGJGS2hJTG9jQldxN3p5Tmw5aHIKdlVHVC9XWmN3MHQvT3RNNzJTUGFwbG1UZ1ZiYlFSeGYyVkh6eXB0R0l2dHlkbFhLOHRoeE9NcFhvNGUrU2w4ZAoxZ2RRY0M0b2lzTjlGMjlvTnM4UDV5RlFQLy94WXV2OEM2MDduQ2oxRHpySWQ1YXZHL05WZktCL2ZiREtFRmdOCjJXaEhJblR6UExFY2pGNGZFcmNVQUV1V1cwYnVYLzZGSENHM2lUdHJxeUQ5MktUVkRmTjFKNTZycmNzQ0F3RUEKQVFLQ0FnRUFrOHE4czRQcnZZYnk3OVVWbFdKTktxY2V5a3dCa3hFMWZqcllPUldRMmhpQWlyeEdWNSs4bERULwprNnVqbTFFV3diNUswSHh4UktrYitQRWExSHFOTkhFNkp4TnBKS0s5ZXhEbFlBUSt4N2RGQnFWci8ybmF6bW80Ck1COE1MWWxtSXp0V1dvU1l3ZThvMm1FZzRxK2J4WXM1SW1kdTdBa2hFN2RKNjNobTIzZ0xNZmVNTGFsUnFvcHUKWEJQd0U1blhQNmFHdVVOSHRHMUs4dFFKRGxaWStMRWJBZU9mUmVOUWhUOU5kUnVrWVNXNTc5dmZLYmxKclN2egp1bGc4OXNWbTNjV0VLNXBCNnJqOXdKYks5NHZvS2Z0VnFiYnVCd1dqZDFhOXBpYktod1ZCZTJMMkZXaHBTWmM1CkYvY29DN25qVGFZVDZ0cjkxeTVWaGhKaElaUUNmL3Z2NFpsNVhoRkhzNVZUWk5iTS9PZnF5RlFMWVhWSk80OEsKRjd0bWF6QUVRUUJRd1ZacUg5QzlOUWR6UEhXbWMzOE9raHRjMXd6YXFuL3JnOSsxc2dBTUQ4aFdDdFFKVWU5NwpiOXltaDVBMFo0UVhLcHlGVDBiK3BYY0QxalJoYTA3VXRrWCsvekxKOUhwQVhjVW16a0crajVDWE5wbnhzSXE1CmZKRmVxM2hCajl3Nm40aCs1ME00VzBGc2U1WW9FVXNjM0IwZno4QmxRQmIrWUpMRkxOSDM0TUg4cDFsMFpEWUoKeWFlMHBzeGxCaWpnNE9QWitXQ0JhK2p0Rlc0TGlXZ0VjeHdnejh3K2hFT0FRcjJhMURjN3c4amQrWTRJSzhVbQpsVFZzNWRicDRtT21QTWxSdi9HTTdrRHVkRnFiTWczWUZ3WGczUWJxdVZxTFp6RXpqVmtDZ2dFQkFQSktaYkNXCllmTGVqa1MvZmtSeVYzVkliNTRtS3dRSG9NV3ViODh0UGdHdVh6anNKeWQ1UVRRNThQcFVqWHJMSG1uOGxTMisKdmlFOEdKeWxLd04xeU1sWnc0MCtrWmhwSFVwQ1d4LzJaS2pBcXZxQTlPT0tvMmZ2NkhkL3dPQW5VNEN0aW9DMQpwcmk3bEtGWVhvUDhEdFFWd0hZdkl6Q1JxRG5oYzRtd0pEcXpUQzl4ZHVJK3N2eHpsNHhIODJmeDBqclBpRlkrCi93T2RYanlmSVBqeWhIQzRqUFRXYmFpcndYUzlkQmpTbDEyOGFJUlQ1ODAveVhFL1NZQXVnZzA1akt0ZzV6UUEKU28xM01UZXpYUkhYZE8wZGkzdEVNSEdSRUVrRnBlVm5uUFF2Q0NlZEswRFYzNmlOd2lXYzhwd2RmTE1WbmVUdApES3daZWRDeCtvLzdldjBDZ2dFQkFPdTQ4REdFSkpKekh4VlI1bVkxSzJBbFp5WXRwVE9XZWhLMXpYNzRKdk0zCll4TjRuZCtaeDVuOXVTUG1tS3pxRjNUVSs0NFJWdGRKSzZlam9GRThkTURUTldhU0xXL1pEbU4xblQwbmp2T24KSVdKbjU5eW5PQ2hXV0taZ1haLzlVcUdSN1B0Nk94U2trZXg5Yy9mWUJzTVgveHVzZFhRaWdlb2dsMGlPWVZGVwpnWElpaUxSTEhwSEpzSy91TnhJaXpqMGhUWVluN3VEN1BSRU53RlJjQ1lmOEoxZVVGYmQ2RHVDVldlUUNLV2dmCk5kMnRTV29pMFZ5bGo0dVVYOEl3MHRqTE5NRDVDUkVKRWs0R1N2NEVEU212VWR2MUxpQktKQ0wybEVjZ29QZUMKb09EMmlDYzVLcWdubVFyYVJpbEZGazhSVlhBOVBXWkdZM0MwYjZUVm1tY0NnZ0VBTlpPMkFPS0FMbENBYlR0YgpGSStrUDA4UlA0dDVINThBTWpac2l3ZWFHbzBRaVduUERxK0ZkNk1JWXBLbjVtdGNBbHZVTVJWb3ZiaW9TSnROCmM2cHNCL3BOZjhKQ044Mm1xSEViN1dseXdNNDZBTUxiWkNXWUZMZThWQkJ2K2lFNEdkQkdQRWZ1NGhLNHZ5VG4KWVpBdlJ6NjRIR280QWRsenRiamc3NlYvbld0Z2dXMDV1TFhjcG01NUtKQVFodisyV1VMakJ3OVBIT0dEb1N3ZgpBbTIrVTU2N3JMaHQ3MHByc1FEajEwbGFKMlF1U0hTMVlYR2xmZUZjdzNlRlVwOVROK0pwdmRvQ29sMmxDSWdsCklIamdaajZPUldmQ3Zwb3hXN1JnQnVadWtxQ0QwUjYwSGRZdGF2eE4zanRpZXBzYXBBODNweE8wSmFwTWdaV1oKcnBVUmtRS0NBUUJPY0V2OUxpdTlUL0dYOXBqa2llelZJWjBoWnk4QjY2RFRlUXZZcEZyUnRDeVQzaDhxdU5GaQp2THRPNXYwSERSNmhFZjVqV0FHOXdldDA3VTM3dWxKZmwraTlLUWRWb0xUWkE5bys3MXJ5V1RzU3MrREQzQ0VqCnl4ZlV4VnhpVUxtZWFpQ2h6aHE2MDhoN0dZUHRoVVU2eGxGdHRBV2hqNW9MZnF6WXlBZzZPTDc2YStOeG0wMmcKMWF5bDNtOFU2ZUFYRjIza3BvVW0rSE5wcVZuR3VKbXpWb1VBNzVZS1orTnJlRWRoU0JiZlB3TjlzSnd0WlVpbAp1N0g0a0hjTTk1SXg4ZXlzQ2pLcUtJcWV6QmxJVGJEVG5qTnZMamNiSjVDKzBhNmx2SVhUMXZRUjUvZUdsYzlNCkJXRTM2MHBOa1YvTEQ4bU9mOUplcGkyUTQzb0RMOUVoQW9JQkFRRFRXSW1meTBLOWdHekEyclB5MTY5bVdZUUsKT2xjbkQzK2hRcTZ4NTFabjFlL3RleEZlVmxoSG40cnJuUmRDRk9BcDQ3dUZrSjJtNzJHQ1ZENzRFd1F1Y0s5eQpBRDVqb3JxZ1ZIcUNLWmRrSGpiMlY2ME16bTZnM3J0TDlXSlhGVkx2TkJiL1FHQjJ2Z0hWT08wenFpcUdaajRlCkV4N2wybS8vNVNFNERMdG43MEo5Q2dHMUh0WENTOGRXckdQTDFwekRuazhWWHRub1h6YjBMQ2hMVUZFZ1pSbWgKY1Y2QUZIRUsySDh3Qkh2aU55ZWhzUlFpRGtsMkFpV09jSk52a3pXNjhjazJuSmpSV3lQWUsxSkwzTkNLcEIzUQpPb2hyUDBmSGNXQVhNVzk3d0ZYWmhSZm5RZkR4eElPbGozTWNZVDBBbGFuWGQwRjROR2MyTnZtcGh4MDQKLS0tLS1FTkQgUlNBIFBSSVZBVEUgS0VZLS0tLS0K</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Secret</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">core-app</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">secret-harbor-core</span>
<span class="na">type</span><span class="pi">:</span> <span class="s">Opaque</span>
<span class="na">stringData</span><span class="pi">:</span>
  <span class="na">secretKey</span><span class="pi">:</span> <span class="s2">"</span><span class="s">not-a-secure-key"</span>
  <span class="na">secret</span><span class="pi">:</span> <span class="s2">"</span><span class="s">please_replace_this_to_random_data"</span>
  <span class="na">HARBOR_ADMIN_PASSWORD</span><span class="pi">:</span> <span class="s2">"</span><span class="s">harbor-admin-password"</span>
  <span class="na">POSTGRESQL_PASSWORD</span><span class="pi">:</span> <span class="s2">"</span><span class="s">harbor_password"</span>
  <span class="na">HARBOR_DATABASE_PASSWORD</span><span class="pi">:</span> <span class="s2">"</span><span class="s">harbor_password"</span>
  <span class="na">REGISTRY_CREDENTIAL_PASSWORD</span><span class="pi">:</span> <span class="s2">"</span><span class="s">harbor_registry_password"</span>
  <span class="na">CSRF_KEY</span><span class="pi">:</span> <span class="s2">"</span><span class="s">please_replace_this_to_random_data"</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Secret</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">core-app</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">secret-harbor-job-service</span>
<span class="na">type</span><span class="pi">:</span> <span class="s">Opaque</span>
<span class="na">stringData</span><span class="pi">:</span>
  <span class="na">JOBSERVICE_SECRET</span><span class="pi">:</span> <span class="s2">"</span><span class="s">please_replace_this_to_random_data"</span>
  <span class="na">REGISTRY_CREDENTIAL_PASSWORD</span><span class="pi">:</span> <span class="s2">"</span><span class="s">harbor_registry_password"</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Secret</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">core-app</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">secret-harbor-registry</span>
<span class="na">type</span><span class="pi">:</span> <span class="s">Opaque</span>
<span class="na">stringData</span><span class="pi">:</span>
  <span class="na">REGISTRY_REDIS_PASSWORD</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
  <span class="na">REGISTRY_HTTP_SECRET</span><span class="pi">:</span> <span class="s2">"</span><span class="s">please_replace_this_to_random_data"</span>
  <span class="na">REGISTRY_HTPASSWD</span><span class="pi">:</span> <span class="s2">"</span><span class="s">harbor_registry_user:$2a$10$WktPbZNT.O/vjv/Y0k.UbuLwxsvddxai/qGu7Kw2TawemGkG2l4H6"</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Secret</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">core-app</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">secret-harbor-trivy</span>
<span class="na">type</span><span class="pi">:</span> <span class="s">Opaque</span>
<span class="na">stringData</span><span class="pi">:</span>
  <span class="na">redisURL</span><span class="pi">:</span> <span class="s">redis://svc-harbor-redis:6379/5?idle_timeout_seconds=30</span>
  <span class="na">gitHubToken</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
<span class="nn">---</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_创建_service">创建 Service</h3>
<div class="paragraph">
<p>配置导入完成后，创建相关的 <strong>Service</strong> 配置。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
</pre></td><td class="code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">core-app</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">svc-harbor-chart-museum</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">harbor</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span> <span class="m">80</span>
      <span class="na">targetPort</span><span class="pi">:</span> <span class="m">9999</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">harbor</span>
    <span class="na">component</span><span class="pi">:</span> <span class="s">chart-museum</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">core-app</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">svc-harbor-core</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">harbor</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">http-web</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">80</span>
      <span class="na">targetPort</span><span class="pi">:</span> <span class="m">8080</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">http-metrics</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">8001</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">harbor</span>
    <span class="na">component</span><span class="pi">:</span> <span class="s">core</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">core-app</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">svc-harbor-exporter</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">harbor</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">http-metrics</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">8001</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">harbor</span>
    <span class="na">component</span><span class="pi">:</span> <span class="s">exporter</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">core-app</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">svc-harbor-job-service</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">harbor</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">http-jobservice</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">80</span>
      <span class="na">targetPort</span><span class="pi">:</span> <span class="m">8080</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">http-metrics</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">8001</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">harbor</span>
    <span class="na">component</span><span class="pi">:</span> <span class="s">job-service</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">core-app</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">svc-harbor-portal</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">harbor</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span> <span class="m">80</span>
      <span class="na">targetPort</span><span class="pi">:</span> <span class="m">8080</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">harbor</span>
    <span class="na">component</span><span class="pi">:</span> <span class="s">portal</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">core-app</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">svc-harbor-redis</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">harbor</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span> <span class="m">6379</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">harbor</span>
    <span class="na">component</span><span class="pi">:</span> <span class="s">redis</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">core-app</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">svc-harbor-registry</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">harbor</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">http-registry</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">5000</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">http-controller</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">8080</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">http-metrics</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">8001</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">harbor</span>
    <span class="na">component</span><span class="pi">:</span> <span class="s">registry</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">core-app</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">svc-harbor-trivy</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">harbor</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">http-trivy</span>
      <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">8080</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">harbor</span>
    <span class="na">component</span><span class="pi">:</span> <span class="s">trivy</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_创建_pod">创建 Pod</h3>
<div class="paragraph">
<p><strong>Service</strong> 创建完成后，在 <strong>Kubernetes</strong> 下导入以下配置来创建 <strong>Harbor</strong> 启动配置。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yml"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
</pre></td><td class="code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">core-app</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">deploy-harbor-chart-museum</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">harbor</span>
    <span class="na">component</span><span class="pi">:</span> <span class="s">chart-museum</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span>
  <span class="na">revisionHistoryLimit</span><span class="pi">:</span> <span class="m">10</span>
  <span class="na">strategy</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">RollingUpdate</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">harbor</span>
      <span class="na">component</span><span class="pi">:</span> <span class="s">chart-museum</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">harbor</span>
        <span class="na">component</span><span class="pi">:</span> <span class="s">chart-museum</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">securityContext</span><span class="pi">:</span>
        <span class="na">runAsUser</span><span class="pi">:</span> <span class="m">10000</span>
        <span class="na">fsGroup</span><span class="pi">:</span> <span class="m">10000</span>
      <span class="na">automountServiceAccountToken</span><span class="pi">:</span> <span class="no">false</span>
      <span class="na">containers</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">chart-museum</span>
          <span class="na">image</span><span class="pi">:</span> <span class="s">goharbor/chartmuseum-photon:v2.5.3</span>
          <span class="na">imagePullPolicy</span><span class="pi">:</span> <span class="s">IfNotPresent</span>
          <span class="na">livenessProbe</span><span class="pi">:</span>
            <span class="na">httpGet</span><span class="pi">:</span>
              <span class="na">path</span><span class="pi">:</span> <span class="s">/health</span>
              <span class="na">scheme</span><span class="pi">:</span> <span class="s">HTTP</span>
              <span class="na">port</span><span class="pi">:</span> <span class="m">9999</span>
            <span class="na">initialDelaySeconds</span><span class="pi">:</span> <span class="m">300</span>
            <span class="na">periodSeconds</span><span class="pi">:</span> <span class="m">10</span>
          <span class="na">readinessProbe</span><span class="pi">:</span>
            <span class="na">httpGet</span><span class="pi">:</span>
              <span class="na">path</span><span class="pi">:</span> <span class="s">/health</span>
              <span class="na">scheme</span><span class="pi">:</span> <span class="s">HTTP</span>
              <span class="na">port</span><span class="pi">:</span> <span class="m">9999</span>
            <span class="na">initialDelaySeconds</span><span class="pi">:</span> <span class="m">1</span>
            <span class="na">periodSeconds</span><span class="pi">:</span> <span class="m">10</span>
          <span class="na">envFrom</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">configMapRef</span><span class="pi">:</span>
                <span class="na">name</span><span class="pi">:</span> <span class="s">conf-harbor-chart-museum</span>
            <span class="pi">-</span> <span class="na">secretRef</span><span class="pi">:</span>
                <span class="na">name</span><span class="pi">:</span> <span class="s">secret-harbor-chart-museum</span>
          <span class="na">env</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">BASIC_AUTH_PASS</span>
              <span class="na">valueFrom</span><span class="pi">:</span>
                <span class="na">secretKeyRef</span><span class="pi">:</span>
                  <span class="na">name</span><span class="pi">:</span> <span class="s">secret-harbor-core</span>
                  <span class="na">key</span><span class="pi">:</span> <span class="s">secret</span>
            <span class="pi">-</span> <span class="c1"># Needed to make AWS' client connect correctly (see https://github.com/helm/chartmuseum/issues/280)</span>
              <span class="na">name</span><span class="pi">:</span> <span class="s">AWS_SDK_LOAD_CONFIG</span>
              <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1"</span>
          <span class="na">ports</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">9999</span>
          <span class="na">volumeMounts</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">chart-museum-data</span>
              <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/chart_storage</span>
      <span class="na">volumes</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">chart-museum-data</span>
          <span class="na">persistentVolumeClaim</span><span class="pi">:</span>
            <span class="na">claimName</span><span class="pi">:</span> <span class="s">pvc-harbor-chart-museum</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">core-app</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">deploy-harbor-core</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">harbor</span>
    <span class="na">component</span><span class="pi">:</span> <span class="s">core</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span>
  <span class="na">revisionHistoryLimit</span><span class="pi">:</span> <span class="m">10</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">harbor</span>
      <span class="na">component</span><span class="pi">:</span> <span class="s">core</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">harbor</span>
        <span class="na">component</span><span class="pi">:</span> <span class="s">core</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">securityContext</span><span class="pi">:</span>
        <span class="na">runAsUser</span><span class="pi">:</span> <span class="m">10000</span>
        <span class="na">fsGroup</span><span class="pi">:</span> <span class="m">10000</span>
      <span class="na">automountServiceAccountToken</span><span class="pi">:</span> <span class="no">false</span>
      <span class="na">terminationGracePeriodSeconds</span><span class="pi">:</span> <span class="m">120</span>
      <span class="na">containers</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">core</span>
          <span class="na">image</span><span class="pi">:</span> <span class="s">goharbor/harbor-core:v2.5.3</span>
          <span class="na">imagePullPolicy</span><span class="pi">:</span> <span class="s">IfNotPresent</span>
          <span class="na">startupProbe</span><span class="pi">:</span>
            <span class="na">httpGet</span><span class="pi">:</span>
              <span class="na">path</span><span class="pi">:</span> <span class="s">/api/v2.0/ping</span>
              <span class="na">scheme</span><span class="pi">:</span> <span class="s">HTTP</span>
              <span class="na">port</span><span class="pi">:</span> <span class="m">8080</span>
            <span class="na">failureThreshold</span><span class="pi">:</span> <span class="m">360</span>
            <span class="na">initialDelaySeconds</span><span class="pi">:</span> <span class="m">10</span>
            <span class="na">periodSeconds</span><span class="pi">:</span> <span class="m">10</span>
          <span class="na">livenessProbe</span><span class="pi">:</span>
            <span class="na">httpGet</span><span class="pi">:</span>
              <span class="na">path</span><span class="pi">:</span> <span class="s">/api/v2.0/ping</span>
              <span class="na">scheme</span><span class="pi">:</span> <span class="s">HTTP</span>
              <span class="na">port</span><span class="pi">:</span> <span class="m">8080</span>
            <span class="na">failureThreshold</span><span class="pi">:</span> <span class="m">2</span>
            <span class="na">periodSeconds</span><span class="pi">:</span> <span class="m">10</span>
          <span class="na">readinessProbe</span><span class="pi">:</span>
            <span class="na">httpGet</span><span class="pi">:</span>
              <span class="na">path</span><span class="pi">:</span> <span class="s">/api/v2.0/ping</span>
              <span class="na">scheme</span><span class="pi">:</span> <span class="s">HTTP</span>
              <span class="na">port</span><span class="pi">:</span> <span class="m">8080</span>
            <span class="na">failureThreshold</span><span class="pi">:</span> <span class="m">2</span>
            <span class="na">periodSeconds</span><span class="pi">:</span> <span class="m">10</span>
          <span class="na">envFrom</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">configMapRef</span><span class="pi">:</span>
                <span class="na">name</span><span class="pi">:</span> <span class="s">conf-harbor-core</span>
            <span class="pi">-</span> <span class="na">secretRef</span><span class="pi">:</span>
                <span class="na">name</span><span class="pi">:</span> <span class="s">secret-harbor-core</span>
            <span class="pi">-</span> <span class="na">secretRef</span><span class="pi">:</span>
                <span class="na">name</span><span class="pi">:</span> <span class="s">secret-harbor-internal-tls</span>
          <span class="na">env</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">CORE_SECRET</span>
              <span class="na">valueFrom</span><span class="pi">:</span>
                <span class="na">secretKeyRef</span><span class="pi">:</span>
                  <span class="na">name</span><span class="pi">:</span> <span class="s">secret-harbor-core</span>
                  <span class="na">key</span><span class="pi">:</span> <span class="s">secret</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">JOBSERVICE_SECRET</span>
              <span class="na">valueFrom</span><span class="pi">:</span>
                <span class="na">secretKeyRef</span><span class="pi">:</span>
                  <span class="na">name</span><span class="pi">:</span> <span class="s">secret-harbor-job-service</span>
                  <span class="na">key</span><span class="pi">:</span> <span class="s">JOBSERVICE_SECRET</span>
          <span class="na">ports</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">8080</span>
          <span class="na">volumeMounts</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">config</span>
              <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/etc/core/app.conf</span>
              <span class="na">subPath</span><span class="pi">:</span> <span class="s">app.conf</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">secret-key</span>
              <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/etc/core/key</span>
              <span class="na">subPath</span><span class="pi">:</span> <span class="s">key</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">token-service-private-key</span>
              <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/etc/core/private_key.pem</span>
              <span class="na">subPath</span><span class="pi">:</span> <span class="s">tls.key</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">psc</span>
              <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/etc/core/token</span>
      <span class="na">volumes</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">config</span>
          <span class="na">configMap</span><span class="pi">:</span>
            <span class="na">name</span><span class="pi">:</span> <span class="s">conf-harbor-core</span>
            <span class="na">items</span><span class="pi">:</span>
              <span class="pi">-</span> <span class="na">key</span><span class="pi">:</span> <span class="s">app.conf</span>
                <span class="na">path</span><span class="pi">:</span> <span class="s">app.conf</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">secret-key</span>
          <span class="na">secret</span><span class="pi">:</span>
            <span class="na">secretName</span><span class="pi">:</span> <span class="s">secret-harbor-core</span>
            <span class="na">items</span><span class="pi">:</span>
              <span class="pi">-</span> <span class="na">key</span><span class="pi">:</span> <span class="s">secretKey</span>
                <span class="na">path</span><span class="pi">:</span> <span class="s">key</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">token-service-private-key</span>
          <span class="na">secret</span><span class="pi">:</span>
            <span class="na">secretName</span><span class="pi">:</span> <span class="s">secret-harbor-internal-tls</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">psc</span>
          <span class="na">emptyDir</span><span class="pi">:</span> <span class="pi">{</span> <span class="pi">}</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">core-app</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">deploy-harbor-exporter</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">harbor</span>
    <span class="na">component</span><span class="pi">:</span> <span class="s">exporter</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span>
  <span class="na">revisionHistoryLimit</span><span class="pi">:</span> <span class="m">10</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">harbor</span>
      <span class="na">component</span><span class="pi">:</span> <span class="s">exporter</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">harbor</span>
        <span class="na">component</span><span class="pi">:</span> <span class="s">exporter</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">securityContext</span><span class="pi">:</span>
        <span class="na">runAsUser</span><span class="pi">:</span> <span class="m">10000</span>
        <span class="na">fsGroup</span><span class="pi">:</span> <span class="m">10000</span>
      <span class="na">automountServiceAccountToken</span><span class="pi">:</span> <span class="no">false</span>
      <span class="na">containers</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">exporter</span>
          <span class="na">image</span><span class="pi">:</span> <span class="s">goharbor/harbor-exporter:v2.5.3</span>
          <span class="na">imagePullPolicy</span><span class="pi">:</span> <span class="s">IfNotPresent</span>
          <span class="na">livenessProbe</span><span class="pi">:</span>
            <span class="na">httpGet</span><span class="pi">:</span>
              <span class="na">path</span><span class="pi">:</span> <span class="s">/</span>
              <span class="na">port</span><span class="pi">:</span> <span class="m">8001</span>
            <span class="na">initialDelaySeconds</span><span class="pi">:</span> <span class="m">300</span>
            <span class="na">periodSeconds</span><span class="pi">:</span> <span class="m">10</span>
          <span class="na">readinessProbe</span><span class="pi">:</span>
            <span class="na">httpGet</span><span class="pi">:</span>
              <span class="na">path</span><span class="pi">:</span> <span class="s">/</span>
              <span class="na">port</span><span class="pi">:</span> <span class="m">8001</span>
            <span class="na">initialDelaySeconds</span><span class="pi">:</span> <span class="m">30</span>
            <span class="na">periodSeconds</span><span class="pi">:</span> <span class="m">10</span>
          <span class="na">args</span><span class="pi">:</span> <span class="pi">[</span> <span class="s2">"</span><span class="s">-log-level"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">info"</span> <span class="pi">]</span>
          <span class="na">envFrom</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">configMapRef</span><span class="pi">:</span>
                <span class="na">name</span><span class="pi">:</span> <span class="s">conf-harbor-exporter-env</span>
            <span class="pi">-</span> <span class="na">secretRef</span><span class="pi">:</span>
                <span class="na">name</span><span class="pi">:</span> <span class="s">secret-harbor-core</span>
            <span class="pi">-</span> <span class="na">secretRef</span><span class="pi">:</span>
                <span class="na">name</span><span class="pi">:</span> <span class="s">secret-harbor-internal-tls</span>
          <span class="na">ports</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">8080</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">core-app</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">deploy-harbor-job-service</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">harbor</span>
    <span class="na">component</span><span class="pi">:</span> <span class="s">job-service</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span>
  <span class="na">revisionHistoryLimit</span><span class="pi">:</span> <span class="m">10</span>
  <span class="na">strategy</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">RollingUpdate</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">harbor</span>
      <span class="na">component</span><span class="pi">:</span> <span class="s">job-service</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">harbor</span>
        <span class="na">component</span><span class="pi">:</span> <span class="s">job-service</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">securityContext</span><span class="pi">:</span>
        <span class="na">runAsUser</span><span class="pi">:</span> <span class="m">10000</span>
        <span class="na">fsGroup</span><span class="pi">:</span> <span class="m">10000</span>
      <span class="na">automountServiceAccountToken</span><span class="pi">:</span> <span class="no">false</span>
      <span class="na">terminationGracePeriodSeconds</span><span class="pi">:</span> <span class="m">120</span>
      <span class="na">containers</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">job-service</span>
          <span class="na">image</span><span class="pi">:</span> <span class="s">goharbor/harbor-jobservice:v2.5.3</span>
          <span class="na">imagePullPolicy</span><span class="pi">:</span> <span class="s">IfNotPresent</span>
          <span class="na">livenessProbe</span><span class="pi">:</span>
            <span class="na">httpGet</span><span class="pi">:</span>
              <span class="na">path</span><span class="pi">:</span> <span class="s">/api/v1/stats</span>
              <span class="na">scheme</span><span class="pi">:</span> <span class="s">HTTP</span>
              <span class="na">port</span><span class="pi">:</span> <span class="m">8080</span>
            <span class="na">initialDelaySeconds</span><span class="pi">:</span> <span class="m">300</span>
            <span class="na">periodSeconds</span><span class="pi">:</span> <span class="m">10</span>
          <span class="na">readinessProbe</span><span class="pi">:</span>
            <span class="na">httpGet</span><span class="pi">:</span>
              <span class="na">path</span><span class="pi">:</span> <span class="s">/api/v1/stats</span>
              <span class="na">scheme</span><span class="pi">:</span> <span class="s">HTTP</span>
              <span class="na">port</span><span class="pi">:</span> <span class="m">8080</span>
            <span class="na">initialDelaySeconds</span><span class="pi">:</span> <span class="m">20</span>
            <span class="na">periodSeconds</span><span class="pi">:</span> <span class="m">10</span>
          <span class="na">env</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">CORE_SECRET</span>
              <span class="na">valueFrom</span><span class="pi">:</span>
                <span class="na">secretKeyRef</span><span class="pi">:</span>
                  <span class="na">name</span><span class="pi">:</span> <span class="s">secret-harbor-core</span>
                  <span class="na">key</span><span class="pi">:</span> <span class="s">secret</span>
          <span class="na">envFrom</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">configMapRef</span><span class="pi">:</span>
                <span class="na">name</span><span class="pi">:</span> <span class="s">conf-harbor-job-service-env</span>
            <span class="pi">-</span> <span class="na">secretRef</span><span class="pi">:</span>
                <span class="na">name</span><span class="pi">:</span> <span class="s">secret-harbor-job-service</span>
          <span class="na">ports</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">8080</span>
          <span class="na">volumeMounts</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">job-service-config</span>
              <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/etc/jobservice/config.yml</span>
              <span class="na">subPath</span><span class="pi">:</span> <span class="s">config.yml</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">job-logs</span>
              <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/var/log/jobs</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">job-scan-data-exports</span>
              <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/var/scandata_exports</span>
      <span class="na">volumes</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">job-service-config</span>
          <span class="na">configMap</span><span class="pi">:</span>
            <span class="na">name</span><span class="pi">:</span> <span class="s">harbor-job-service</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">job-logs</span>
          <span class="na">persistentVolumeClaim</span><span class="pi">:</span>
            <span class="na">claimName</span><span class="pi">:</span>  <span class="s">pvc-harbor-job-service</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">job-scan-data-exports</span>
          <span class="na">persistentVolumeClaim</span><span class="pi">:</span>
            <span class="na">claimName</span><span class="pi">:</span> <span class="s">pvc-harbor-job-service-scan-data</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">core-app</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">deploy-harbor-portal</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">harbor</span>
    <span class="na">component</span><span class="pi">:</span> <span class="s">portal</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span>
  <span class="na">revisionHistoryLimit</span><span class="pi">:</span> <span class="m">10</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">harbor</span>
      <span class="na">component</span><span class="pi">:</span> <span class="s">portal</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">harbor</span>
        <span class="na">component</span><span class="pi">:</span> <span class="s">portal</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">securityContext</span><span class="pi">:</span>
        <span class="na">runAsUser</span><span class="pi">:</span> <span class="m">10000</span>
        <span class="na">fsGroup</span><span class="pi">:</span> <span class="m">10000</span>
      <span class="na">automountServiceAccountToken</span><span class="pi">:</span> <span class="no">false</span>
      <span class="na">containers</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">portal</span>
          <span class="na">image</span><span class="pi">:</span> <span class="s">goharbor/harbor-portal:v2.5.3</span>
          <span class="na">imagePullPolicy</span><span class="pi">:</span> <span class="s">IfNotPresent</span>
          <span class="na">livenessProbe</span><span class="pi">:</span>
            <span class="na">httpGet</span><span class="pi">:</span>
              <span class="na">path</span><span class="pi">:</span> <span class="s">/</span>
              <span class="na">scheme</span><span class="pi">:</span> <span class="s">HTTP</span>
              <span class="na">port</span><span class="pi">:</span> <span class="m">8080</span>
            <span class="na">initialDelaySeconds</span><span class="pi">:</span> <span class="m">300</span>
            <span class="na">periodSeconds</span><span class="pi">:</span> <span class="m">10</span>
          <span class="na">readinessProbe</span><span class="pi">:</span>
            <span class="na">httpGet</span><span class="pi">:</span>
              <span class="na">path</span><span class="pi">:</span> <span class="s">/</span>
              <span class="na">scheme</span><span class="pi">:</span> <span class="s">HTTP</span>
              <span class="na">port</span><span class="pi">:</span> <span class="m">8080</span>
            <span class="na">initialDelaySeconds</span><span class="pi">:</span> <span class="m">1</span>
            <span class="na">periodSeconds</span><span class="pi">:</span> <span class="m">10</span>
          <span class="na">ports</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">8080</span>
          <span class="na">volumeMounts</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">portal-config</span>
              <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/etc/nginx/nginx.conf</span>
              <span class="na">subPath</span><span class="pi">:</span> <span class="s">nginx.conf</span>
      <span class="na">volumes</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">portal-config</span>
          <span class="na">configMap</span><span class="pi">:</span>
            <span class="na">name</span><span class="pi">:</span> <span class="s">conf-harbor-portal</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">core-app</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">deploy-harbor-registry</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">harbor</span>
    <span class="na">component</span><span class="pi">:</span> <span class="s">registry</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span>
  <span class="na">revisionHistoryLimit</span><span class="pi">:</span> <span class="m">10</span>
  <span class="na">strategy</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">RollingUpdate</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">harbor</span>
      <span class="na">component</span><span class="pi">:</span> <span class="s">registry</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">harbor</span>
        <span class="na">component</span><span class="pi">:</span> <span class="s">registry</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">securityContext</span><span class="pi">:</span>
        <span class="na">runAsUser</span><span class="pi">:</span> <span class="m">10000</span>
        <span class="na">fsGroup</span><span class="pi">:</span> <span class="m">10000</span>
        <span class="na">fsGroupChangePolicy</span><span class="pi">:</span> <span class="s">OnRootMismatch</span>
      <span class="na">automountServiceAccountToken</span><span class="pi">:</span> <span class="no">false</span>
      <span class="na">terminationGracePeriodSeconds</span><span class="pi">:</span> <span class="m">120</span>
      <span class="na">containers</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">registry</span>
          <span class="na">image</span><span class="pi">:</span> <span class="s">goharbor/registry-photon:v2.5.3</span>
          <span class="na">imagePullPolicy</span><span class="pi">:</span> <span class="s">IfNotPresent</span>
          <span class="na">livenessProbe</span><span class="pi">:</span>
            <span class="na">httpGet</span><span class="pi">:</span>
              <span class="na">path</span><span class="pi">:</span> <span class="s">/</span>
              <span class="na">scheme</span><span class="pi">:</span> <span class="s">HTTP</span>
              <span class="na">port</span><span class="pi">:</span> <span class="m">5000</span>
            <span class="na">initialDelaySeconds</span><span class="pi">:</span> <span class="m">300</span>
            <span class="na">periodSeconds</span><span class="pi">:</span> <span class="m">10</span>
          <span class="na">readinessProbe</span><span class="pi">:</span>
            <span class="na">httpGet</span><span class="pi">:</span>
              <span class="na">path</span><span class="pi">:</span> <span class="s">/</span>
              <span class="na">scheme</span><span class="pi">:</span> <span class="s">HTTP</span>
              <span class="na">port</span><span class="pi">:</span> <span class="m">5000</span>
            <span class="na">initialDelaySeconds</span><span class="pi">:</span> <span class="m">1</span>
            <span class="na">periodSeconds</span><span class="pi">:</span> <span class="m">10</span>
          <span class="na">args</span><span class="pi">:</span> <span class="pi">[</span> <span class="s2">"</span><span class="s">serve"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">/etc/registry/config.yml"</span> <span class="pi">]</span>
          <span class="na">envFrom</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">secretRef</span><span class="pi">:</span>
                <span class="na">name</span><span class="pi">:</span> <span class="s">secret-harbor-registry</span>
          <span class="na">ports</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">5000</span>
            <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">5001</span>
          <span class="na">volumeMounts</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">registry-data</span>
              <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/storage</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">registry-htpasswd</span>
              <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/etc/registry/passwd</span>
              <span class="na">subPath</span><span class="pi">:</span> <span class="s">passwd</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">registry-config</span>
              <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/etc/registry/config.yml</span>
              <span class="na">subPath</span><span class="pi">:</span> <span class="s">config.yml</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">registryctl</span>
          <span class="na">image</span><span class="pi">:</span> <span class="s">goharbor/harbor-registryctl:v2.5.3</span>
          <span class="na">imagePullPolicy</span><span class="pi">:</span> <span class="s">IfNotPresent</span>
          <span class="na">livenessProbe</span><span class="pi">:</span>
            <span class="na">httpGet</span><span class="pi">:</span>
              <span class="na">path</span><span class="pi">:</span> <span class="s">/api/health</span>
              <span class="na">scheme</span><span class="pi">:</span> <span class="s">HTTP</span>
              <span class="na">port</span><span class="pi">:</span> <span class="m">8080</span>
            <span class="na">initialDelaySeconds</span><span class="pi">:</span> <span class="m">300</span>
            <span class="na">periodSeconds</span><span class="pi">:</span> <span class="m">10</span>
          <span class="na">readinessProbe</span><span class="pi">:</span>
            <span class="na">httpGet</span><span class="pi">:</span>
              <span class="na">path</span><span class="pi">:</span> <span class="s">/api/health</span>
              <span class="na">scheme</span><span class="pi">:</span> <span class="s">HTTP</span>
              <span class="na">port</span><span class="pi">:</span> <span class="m">8080</span>
            <span class="na">initialDelaySeconds</span><span class="pi">:</span> <span class="m">1</span>
            <span class="na">periodSeconds</span><span class="pi">:</span> <span class="m">10</span>
          <span class="na">envFrom</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">secretRef</span><span class="pi">:</span>
                <span class="na">name</span><span class="pi">:</span> <span class="s">secret-harbor-registry</span>
          <span class="na">env</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">CORE_SECRET</span>
              <span class="na">valueFrom</span><span class="pi">:</span>
                <span class="na">secretKeyRef</span><span class="pi">:</span>
                  <span class="na">name</span><span class="pi">:</span> <span class="s">secret-harbor-core</span>
                  <span class="na">key</span><span class="pi">:</span> <span class="s">secret</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">JOBSERVICE_SECRET</span>
              <span class="na">valueFrom</span><span class="pi">:</span>
                <span class="na">secretKeyRef</span><span class="pi">:</span>
                  <span class="na">name</span><span class="pi">:</span> <span class="s">secret-harbor-job-service</span>
                  <span class="na">key</span><span class="pi">:</span> <span class="s">JOBSERVICE_SECRET</span>
          <span class="na">ports</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">8080</span>
          <span class="na">volumeMounts</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">registry-data</span>
              <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/storage</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">registry-config</span>
              <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/etc/registry/config.yml</span>
              <span class="na">subPath</span><span class="pi">:</span> <span class="s">config.yml</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">registry-config</span>
              <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/etc/registryctl/config.yml</span>
              <span class="na">subPath</span><span class="pi">:</span> <span class="s">ctl-config.yml</span>
      <span class="na">volumes</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">registry-htpasswd</span>
          <span class="na">secret</span><span class="pi">:</span>
            <span class="na">secretName</span><span class="pi">:</span> <span class="s">secret-harbor-registry</span>

            <span class="na">items</span><span class="pi">:</span>
              <span class="pi">-</span> <span class="na">key</span><span class="pi">:</span> <span class="s">REGISTRY_HTPASSWD</span>
                <span class="na">path</span><span class="pi">:</span> <span class="s">passwd</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">registry-config</span>
          <span class="na">configMap</span><span class="pi">:</span>
            <span class="na">name</span><span class="pi">:</span> <span class="s">conf-harbor-registry</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">registry-data</span>
          <span class="na">persistentVolumeClaim</span><span class="pi">:</span>
            <span class="na">claimName</span><span class="pi">:</span> <span class="s">pvc-harbor-registry</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">StatefulSet</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">core-app</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">sts-harbor-redis</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">harbor</span>
    <span class="na">component</span><span class="pi">:</span> <span class="s">redis</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span>
  <span class="na">serviceName</span><span class="pi">:</span> <span class="s">svc-harbor-redis</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">harbor</span>
      <span class="na">component</span><span class="pi">:</span> <span class="s">redis</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">harbor</span>
        <span class="na">component</span><span class="pi">:</span> <span class="s">redis</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">securityContext</span><span class="pi">:</span>
        <span class="na">runAsUser</span><span class="pi">:</span> <span class="m">999</span>
        <span class="na">fsGroup</span><span class="pi">:</span> <span class="m">999</span>
      <span class="na">automountServiceAccountToken</span><span class="pi">:</span> <span class="no">false</span>
      <span class="na">terminationGracePeriodSeconds</span><span class="pi">:</span> <span class="m">120</span>
      <span class="na">containers</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">redis</span>
          <span class="na">image</span><span class="pi">:</span> <span class="s">goharbor/redis-photon:v2.5.3</span>
          <span class="na">imagePullPolicy</span><span class="pi">:</span> <span class="s">IfNotPresent</span>
          <span class="na">livenessProbe</span><span class="pi">:</span>
            <span class="na">tcpSocket</span><span class="pi">:</span>
              <span class="na">port</span><span class="pi">:</span> <span class="m">6379</span>
            <span class="na">initialDelaySeconds</span><span class="pi">:</span> <span class="m">300</span>
            <span class="na">periodSeconds</span><span class="pi">:</span> <span class="m">10</span>
          <span class="na">readinessProbe</span><span class="pi">:</span>
            <span class="na">tcpSocket</span><span class="pi">:</span>
              <span class="na">port</span><span class="pi">:</span> <span class="m">6379</span>
            <span class="na">initialDelaySeconds</span><span class="pi">:</span> <span class="m">1</span>
            <span class="na">periodSeconds</span><span class="pi">:</span> <span class="m">10</span>
          <span class="na">volumeMounts</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">redis-data</span>
              <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/var/lib/redis</span>
      <span class="na">volumes</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">redis-data</span>
          <span class="na">persistentVolumeClaim</span><span class="pi">:</span>
            <span class="na">claimName</span><span class="pi">:</span> <span class="s">pvc-harbor-redis-data</span>

<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">StatefulSet</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">core-app</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">sts-harbor-trivy</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">harbor</span>
    <span class="na">component</span><span class="pi">:</span> <span class="s">trivy</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span>
  <span class="na">serviceName</span><span class="pi">:</span> <span class="s">svc-harbor-trivy</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">harbor</span>
      <span class="na">component</span><span class="pi">:</span> <span class="s">trivy</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">harbor</span>
        <span class="na">component</span><span class="pi">:</span> <span class="s">trivy</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">securityContext</span><span class="pi">:</span>
        <span class="na">runAsUser</span><span class="pi">:</span> <span class="m">10000</span>
        <span class="na">fsGroup</span><span class="pi">:</span> <span class="m">10000</span>
      <span class="na">automountServiceAccountToken</span><span class="pi">:</span> <span class="no">false</span>
      <span class="na">containers</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">trivy</span>
          <span class="na">image</span><span class="pi">:</span> <span class="s">goharbor/trivy-adapter-photon:v2.5.3</span>
          <span class="na">imagePullPolicy</span><span class="pi">:</span> <span class="s">IfNotPresent</span>
          <span class="na">securityContext</span><span class="pi">:</span>
            <span class="na">privileged</span><span class="pi">:</span> <span class="no">false</span>
            <span class="na">allowPrivilegeEscalation</span><span class="pi">:</span> <span class="no">false</span>
          <span class="na">env</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">HTTP_PROXY</span>
              <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">HTTPS_PROXY</span>
              <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">NO_PROXY</span>
              <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">svc-harbor-core,svc-harbor-job-service,harbor-database,svc-harbor-chart-museum,svc-harbor-notary-server,svc-harbor-notary-signer,svc-harbor-registry,svc-harbor-portal,svc-harbor-trivy,svc-harbor-exporter,127.0.0.1,localhost,.local,.internal"</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">SCANNER_LOG_LEVEL"</span>
              <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">info"</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">SCANNER_TRIVY_CACHE_DIR"</span>
              <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/home/scanner/.cache/trivy"</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">SCANNER_TRIVY_REPORTS_DIR"</span>
              <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/home/scanner/.cache/reports"</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">SCANNER_TRIVY_DEBUG_MODE"</span>
              <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">false"</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">SCANNER_TRIVY_VULN_TYPE"</span>
              <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">os,library"</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">SCANNER_TRIVY_TIMEOUT"</span>
              <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">5m0s"</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">SCANNER_TRIVY_GITHUB_TOKEN"</span>
              <span class="na">valueFrom</span><span class="pi">:</span>
                <span class="na">secretKeyRef</span><span class="pi">:</span>
                  <span class="na">name</span><span class="pi">:</span> <span class="s">secret-harbor-trivy</span>
                  <span class="na">key</span><span class="pi">:</span> <span class="s">gitHubToken</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">SCANNER_TRIVY_SEVERITY"</span>
              <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">UNKNOWN,LOW,MEDIUM,HIGH,CRITICAL"</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">SCANNER_TRIVY_IGNORE_UNFIXED"</span>
              <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">false"</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">SCANNER_TRIVY_SKIP_UPDATE"</span>
              <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">false"</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">SCANNER_TRIVY_OFFLINE_SCAN"</span>
              <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">false"</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">SCANNER_TRIVY_INSECURE"</span>
              <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">false"</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">SCANNER_API_SERVER_ADDR</span>
              <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">:8080"</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">SCANNER_REDIS_URL"</span>
              <span class="na">valueFrom</span><span class="pi">:</span>
                <span class="na">secretKeyRef</span><span class="pi">:</span>
                  <span class="na">name</span><span class="pi">:</span> <span class="s">secret-harbor-trivy</span>
                  <span class="na">key</span><span class="pi">:</span> <span class="s">redisURL</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">SCANNER_STORE_REDIS_URL"</span>
              <span class="na">valueFrom</span><span class="pi">:</span>
                <span class="na">secretKeyRef</span><span class="pi">:</span>
                  <span class="na">name</span><span class="pi">:</span> <span class="s">secret-harbor-trivy</span>
                  <span class="na">key</span><span class="pi">:</span> <span class="s">redisURL</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">SCANNER_JOB_QUEUE_REDIS_URL"</span>
              <span class="na">valueFrom</span><span class="pi">:</span>
                <span class="na">secretKeyRef</span><span class="pi">:</span>
                  <span class="na">name</span><span class="pi">:</span> <span class="s">secret-harbor-trivy</span>
                  <span class="na">key</span><span class="pi">:</span> <span class="s">redisURL</span>
          <span class="na">ports</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">api-server</span>
              <span class="na">containerPort</span><span class="pi">:</span> <span class="m">8080</span>
          <span class="na">volumeMounts</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">cache-data</span>
              <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/home/scanner/.cache</span>
              <span class="na">readOnly</span><span class="pi">:</span> <span class="no">false</span>
          <span class="na">livenessProbe</span><span class="pi">:</span>
            <span class="na">httpGet</span><span class="pi">:</span>
              <span class="na">scheme</span><span class="pi">:</span> <span class="s">HTTP</span>
              <span class="na">path</span><span class="pi">:</span> <span class="s">/probe/healthy</span>
              <span class="na">port</span><span class="pi">:</span> <span class="s">api-server</span>
            <span class="na">initialDelaySeconds</span><span class="pi">:</span> <span class="m">5</span>
            <span class="na">periodSeconds</span><span class="pi">:</span> <span class="m">10</span>
            <span class="na">successThreshold</span><span class="pi">:</span> <span class="m">1</span>
            <span class="na">failureThreshold</span><span class="pi">:</span> <span class="m">10</span>
          <span class="na">readinessProbe</span><span class="pi">:</span>
            <span class="na">httpGet</span><span class="pi">:</span>
              <span class="na">scheme</span><span class="pi">:</span> <span class="s">HTTP</span>
              <span class="na">path</span><span class="pi">:</span> <span class="s">/probe/ready</span>
              <span class="na">port</span><span class="pi">:</span> <span class="s">api-server</span>
            <span class="na">initialDelaySeconds</span><span class="pi">:</span> <span class="m">5</span>
            <span class="na">periodSeconds</span><span class="pi">:</span> <span class="m">10</span>
            <span class="na">successThreshold</span><span class="pi">:</span> <span class="m">1</span>
            <span class="na">failureThreshold</span><span class="pi">:</span> <span class="m">3</span>
      <span class="na">volumes</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">cache-data</span>
          <span class="na">persistentVolumeClaim</span><span class="pi">:</span>
            <span class="na">claimName</span><span class="pi">:</span> <span class="s">pvc-harbor-trivy-data</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_创建_ingress">创建 Ingress</h3>
<div class="paragraph">
<p><strong>Deployment</strong> 创建完成后,将 <strong>Service</strong> 通过 <strong>Ingress</strong> 暴露到外部地址。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
</pre></td><td class="code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">networking.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Ingress</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">core-app</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">ingress-harbor</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">harbor</span>
  <span class="na">annotations</span><span class="pi">:</span>
    <span class="na">nginx.ingress.kubernetes.io/proxy-body-size</span><span class="pi">:</span> <span class="s2">"</span><span class="s">0"</span>
    <span class="na">nginx.ingress.kubernetes.io/ssl-redirect</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">ingressClassName</span><span class="pi">:</span> <span class="s">nginx</span>
  <span class="na">tls</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">secretName</span><span class="pi">:</span> <span class="s1">'</span><span class="s">tls-d7z-net'</span>
      <span class="na">hosts</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">harbor.d7z.net</span>
  <span class="na">rules</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">http</span><span class="pi">:</span>
        <span class="na">paths</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">path</span><span class="pi">:</span> <span class="s">/api/</span>
            <span class="na">pathType</span><span class="pi">:</span> <span class="s">Prefix</span>
            <span class="na">backend</span><span class="pi">:</span>
              <span class="na">service</span><span class="pi">:</span>
                <span class="na">name</span><span class="pi">:</span> <span class="s">svc-harbor-core</span>
                <span class="na">port</span><span class="pi">:</span>
                  <span class="na">number</span><span class="pi">:</span> <span class="m">80</span>
          <span class="pi">-</span> <span class="na">path</span><span class="pi">:</span> <span class="s">/service/</span>
            <span class="na">pathType</span><span class="pi">:</span> <span class="s">Prefix</span>
            <span class="na">backend</span><span class="pi">:</span>
              <span class="na">service</span><span class="pi">:</span>
                <span class="na">name</span><span class="pi">:</span> <span class="s">svc-harbor-core</span>
                <span class="na">port</span><span class="pi">:</span>
                  <span class="na">number</span><span class="pi">:</span> <span class="m">80</span>
          <span class="pi">-</span> <span class="na">path</span><span class="pi">:</span> <span class="s">/v2/</span>
            <span class="na">pathType</span><span class="pi">:</span> <span class="s">Prefix</span>
            <span class="na">backend</span><span class="pi">:</span>
              <span class="na">service</span><span class="pi">:</span>
                <span class="na">name</span><span class="pi">:</span> <span class="s">svc-harbor-core</span>
                <span class="na">port</span><span class="pi">:</span>
                  <span class="na">number</span><span class="pi">:</span> <span class="m">80</span>
          <span class="pi">-</span> <span class="na">path</span><span class="pi">:</span> <span class="s">/chartrepo/</span>
            <span class="na">pathType</span><span class="pi">:</span> <span class="s">Prefix</span>
            <span class="na">backend</span><span class="pi">:</span>
              <span class="na">service</span><span class="pi">:</span>
                <span class="na">name</span><span class="pi">:</span> <span class="s">svc-harbor-core</span>
                <span class="na">port</span><span class="pi">:</span>
                  <span class="na">number</span><span class="pi">:</span> <span class="m">80</span>
          <span class="pi">-</span> <span class="na">path</span><span class="pi">:</span> <span class="s">/c/</span>
            <span class="na">pathType</span><span class="pi">:</span> <span class="s">Prefix</span>
            <span class="na">backend</span><span class="pi">:</span>
              <span class="na">service</span><span class="pi">:</span>
                <span class="na">name</span><span class="pi">:</span> <span class="s">svc-harbor-core</span>
                <span class="na">port</span><span class="pi">:</span>
                  <span class="na">number</span><span class="pi">:</span> <span class="m">80</span>
          <span class="pi">-</span> <span class="na">path</span><span class="pi">:</span> <span class="s">/</span>
            <span class="na">pathType</span><span class="pi">:</span> <span class="s">Prefix</span>
            <span class="na">backend</span><span class="pi">:</span>
              <span class="na">service</span><span class="pi">:</span>
                <span class="na">name</span><span class="pi">:</span> <span class="s">svc-harbor-portal</span>
                <span class="na">port</span><span class="pi">:</span>
                  <span class="na">number</span><span class="pi">:</span> <span class="m">80</span>
      <span class="na">host</span><span class="pi">:</span> <span class="s">harbor.d7z.net</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_获取部署状态">获取部署状态</h3>
<div class="paragraph">
<p>使用以下命令获取部署状态。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
</pre></td><td class="code"><pre>kubectl get pods,pvc,svc,ingress <span class="nt">-n</span> core-app <span class="nt">-l</span> <span class="nv">app</span><span class="o">=</span>harbor
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_配置_harbor">配置 Harbor</h2>
<div class="sectionbody">
<div class="paragraph">
<p>安装完成后，访问 <code><a target="_blank" href="https://harbor.d7z.net/" class="bare">https://harbor.d7z.net/</a></code> , 使用用户名 <code>admin</code> 和配置的密码 <code>harbor-admin-password</code> 登陆 <strong>Harbor</strong> 。</p>
</div>
<div class="sect2">
<h3 id="_配置_ldap_管理器">配置 LDAP 管理器</h3>
<div class="paragraph">
<p>访问 <code><a target="_blank" href="https://harbor.d7z.net/harbor/configs/auth" class="bare">https://harbor.d7z.net/harbor/configs/auth</a></code>,切换验证模式为 LDAP，按下图填入内容。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/harbor-ldap.png" alt="harbor ldap">
</div>
</div>
<div class="paragraph">
<p><strong>LDAP</strong> 过滤器内容如下:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="text"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
</pre></td><td class="code"><pre>(|(memberOf=cn=admin,ou=groups,dc=cluster,dc=local)(memberOf=cn=docker,ou=groups,dc=cluster,dc=local)(memberOf=cn=deploy,ou=groups,dc=cluster,dc=local))
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>LDAP</strong> 组过滤器内容如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="text"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
</pre></td><td class="code"><pre>(|(cn=admin)(cn=deploy)(cn=docker))
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>编辑完成后，点击 <code>测试LDAP服务器</code> ，如一切无误，点击保存即可。</p>
</div>
</div>
<div class="sect2">
<h3 id="_测试镜像推送">测试镜像推送</h3>
<div class="paragraph">
<p>使用如下命令登陆 <strong>Harbor</strong>,输入具有写入权限的账户和密码，如一切无误，则登陆成功</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
</pre></td><td class="code"><pre>docker login harbor.d7z.net
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="custom-content">
    <style>
        .custom-footer {
            margin: 0;
            padding: 20px;
            background: #555555;
            color: white;
        }

        .custom-footer a {
            color: white;
        }

        .toast {
            max-width: 60%;
            min-width: 150px;
            padding: 0 14px;
            height: 40px;
            color: rgb(255, 255, 255);
            line-height: 40px;
            text-align: center;
            border-radius: 4px;
            position: fixed;
            right: 30px;
            bottom: 30px;
            z-index: 999999;
            background: rgba(0, 0, 0, 0.56);
            font-size: 16px;
        }
    </style>
    <p class="custom-footer">
        代码双击可复制 | 最后编辑于 2022-08-25 03:21:06 |
        <a target="_blank"
           href="https://github.com/d7z-project/all-in-kubernetes/tree/4fcfdc184890d427b4a356259728823a32312b89/core-app-deploy/harbor/README.adoc">查看源码</a> |
        <a target="_blank" href="https://github.com/d7z-project/all-in-kubernetes/tree/4fcfdc184890d427b4a356259728823a32312b89/"
           target="_blank">#4fcfdc</a>
        <script>

            function toast(msg, duration = 1000) {
                const m = document.createElement('div');
                m.innerHTML = msg;
                m.className = "toast"
                document.body.appendChild(m);
                setTimeout(function () {
                    const d = 0.5;
                    m.style.transition = '-webkit-transform ' + d + 's ease-in, opacity ' + d + 's ease-in';
                    m.style.opacity = '0';
                    setTimeout(function () {
                        document.body.removeChild(m)
                    }, d * 1000);
                }, duration);
            }

            function copyData(data) {
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(data);
                    toast("复制成功！")
                }
            }

            window.onload = function () {
                for (let pre of document.getElementsByTagName('pre')) {
                    if (pre.className.includes('rouge') || pre.className.includes('highlight')) {
                        let code = pre.getElementsByClassName('code')[0].innerText;
                        pre.ondblclick = function () {
                            copyData(code)
                        }
                    }
                }

            };
        </script>
</div>
<style>.paragraph > p {
    text-indent: 2em;
}
</style> <script></script>
</html>